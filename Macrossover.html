<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MA Crossover Strategy Tester</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    h1 { color: #333; }
    input, button { margin: 5px; padding: 10px; font-size: 1em; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    #results { background: #fff; padding: 20px; border-radius: 10px; }
  </style>
</head>
<body>
  <h1>MA Crossover Strategy Tester</h1>
  <input type="file" id="csvFile" accept=".csv" />
  <br />
  Fast MA Period: <input type="number" id="fastMA" value="5" />
  Slow MA Period: <input type="number" id="slowMA" value="10" />
  Take Profit (in points): <input type="number" id="tp" value="50" />
  Stop Loss (in points): <input type="number" id="sl" value="30" />
  Initial Capital: <input type="number" id="capital" value="10000" />
  Lot Size: <input type="number" id="lotSize" value="0.1" step="0.01" />
  <button onclick="runStrategy()">Run Strategy</button>  <div id="results"></div>  <script>
    function parseCSV(text) {
      const rows = text.trim().split('\n');
      const headers = rows.shift().split(',');
      return rows.map(row => {
        const values = row.split(',');
        return Object.fromEntries(values.map((v, i) => [headers[i], parseFloat(v)]));
      });
    }

    function calcMA(data, period, key) {
      return data.map((_, i) => {
        if (i < period - 1) return null;
        const slice = data.slice(i - period + 1, i + 1);
        const sum = slice.reduce((acc, d) => acc + d[key], 0);
        return sum / period;
      });
    }

    function runStrategy() {
      const file = document.getElementById('csvFile').files[0];
      if (!file) return alert("Please upload a CSV file.");

      const fastPeriod = parseInt(document.getElementById('fastMA').value);
      const slowPeriod = parseInt(document.getElementById('slowMA').value);
      const tp = parseInt(document.getElementById('tp').value);
      const sl = parseInt(document.getElementById('sl').value);
      let capital = parseFloat(document.getElementById('capital').value);
      const lotSize = parseFloat(document.getElementById('lotSize').value);

      const reader = new FileReader();
      reader.onload = e => {
        const data = parseCSV(e.target.result);
        const closes = data.map(d => d.Close);
        const fastMA = calcMA(data, fastPeriod, 'Close');
        const slowMA = calcMA(data, slowPeriod, 'Close');

        let trades = [];
        let position = null;

        for (let i = 1; i < data.length; i++) {
          const prevFast = fastMA[i - 1];
          const prevSlow = slowMA[i - 1];
          const currFast = fastMA[i];
          const currSlow = slowMA[i];
          if (prevFast === null || prevSlow === null || currFast === null || currSlow === null) continue;

          const entry = data[i].Close;
          const timestamp = data[i].Time;

          if (!position) {
            if (prevFast < prevSlow && currFast > currSlow) {
              position = { type: 'Buy', entry, timestamp };
            } else if (prevFast > prevSlow && currFast < currSlow) {
              position = { type: 'Sell', entry, timestamp };
            }
          } else {
            let exit = null, profit = 0;
            if (position.type === 'Buy') {
              if (data[i].High >= position.entry + tp) {
                exit = position.entry + tp;
                profit = tp * lotSize;
              } else if (data[i].Low <= position.entry - sl) {
                exit = position.entry - sl;
                profit = -sl * lotSize;
              }
            } else {
              if (data[i].Low <= position.entry - tp) {
                exit = position.entry - tp;
                profit = tp * lotSize;
              } else if (data[i].High >= position.entry + sl) {
                exit = position.entry + sl;
                profit = -sl * lotSize;
              }
            }
            if (exit !== null) {
              capital += profit;
              trades.push({
                ...position,
                exit,
                exitTime: timestamp,
                profit,
                capital: capital.toFixed(2)
              });
              position = null;
            }
          }
        }

        document.getElementById('results').innerHTML = `
          <h3>Final Capital: $${capital.toFixed(2)}</h3>
          <table>
            <thead>
              <tr><th>Type</th><th>Entry</th><th>Exit</th><th>Profit</th><th>Capital</th><th>Entry Time</th><th>Exit Time</th></tr>
            </thead>
            <tbody>
              ${trades.map(t => `
                <tr>
                  <td>${t.type}</td>
                  <td>${t.entry}</td>
                  <td>${t.exit}</td>
                  <td>${t.profit.toFixed(2)}</td>
                  <td>${t.capital}</td>
                  <td>${t.timestamp}</td>
                  <td>${t.exitTime}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      };
      reader.readAsText(file);
    }
  </script></body>
</html>
